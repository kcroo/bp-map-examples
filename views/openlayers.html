<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="public/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.0/css/ol.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.0/build/ol.js"></script>
    <title>OpenLayers</title>
</head>
<body>

    <div id="mapid"></div>
    <div id="description" class="inactive description"></div>

    <script>

        // returns promise for loading GeoJSON file and adding the Leaflet layer to the layers array
        async function getGeojsonLayer(fileName, layers) {
            // loading GeoJSON file - Here my html and usa_adm.geojson file resides in same folder
            return $.getJSON(fileName, (data) => {
                layers.push(data);
            })
        }

        const layers = [];
        const promises = [];

        // get promises for each of the CA state senate districts
        for (let i = 1; i <= 40; i++) {
            const promise = getGeojsonLayer(`/ca_state_senate_districts/bp_california state senate district ${i}.geojson`, layers);
            promises.push(promise);
        }
        
        // create your own GeoJSON feature collection
        var featureCollection = {
            'type': 'FeatureCollection',
            'features': []
        };

        // after all GeoJSON files load, add them to group layer, add to map, and zoom to bounds
        Promise.all(promises).then( () => {
            // create feature for GeoJSON feature collection
            for (let i = 1; i <= 40; i++) {
                const feature = {
                    'type': 'Feature',
                    'geometry': layers[i-1],
                    'properties': {
                        'name': `District ${i}`
                    }
                };

                featureCollection.features.push(feature);
            }

            console.log(featureCollection);

            const features = new ol.format.GeoJSON().readFeatures(featureCollection);
            const layer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: features
                })
            });

            const map = new ol.Map({
                target: 'mapid',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM()
                    }),
                    layer
                ],
                view: new ol.View({
                    center: [0, 0],
                    zoom: 2,
                })
            });

            const extent = layer.getSource().getExtent();
            map.getView().fit(extent, map.getSize());

        //     // creates layers for each feature in feature collection
        //     map.addLayer({
        //         'id': 'layerID',
        //         'type': 'fill',     // MUST be fill, otherwise click event doesn't work
        //         'source': 'featureCollectionID',
        //         'layout': {},
        //         'paint': {
        //             'fill-color': '#0000FF',
        //             'fill-opacity': 0.2,                // can't make fill opaque --> outline doesn't show
        //             'fill-outline-color': '#0000FF'
        //         }
        //     });

        //     // only one popup visible on map at one time
        //     var popup = new mapboxgl.Popup();
            
        //     // popup displays on click 
        //     // if wanted to change to mouseon, would need to manually position popup over middle of polygon
        //     map.on('click', 'layerID', function(e) {
        //         console.log(e);
 
        //         var coordinates = e.lngLat;
        //         var name = e.features[0].properties.name;
                
        //         // popup will appear where user clicked, with district name
        //         popup
        //             .setLngLat(coordinates)
        //             .setHTML(name)
        //             .addTo(map);
        //     });

        //     // Change the cursor to a pointer when the mouse is over the places layer.
        //     map.on('mouseenter', 'layerID', function() {
        //         map.getCanvas().style.cursor = 'pointer';
        //     });
            
        //     // Change it back to a pointer when it leaves.
        //     map.on('mouseleave', 'layerID', function() {
        //         map.getCanvas().style.cursor = '';
        //     });
            
        });

    </script>
</body>
</html>

